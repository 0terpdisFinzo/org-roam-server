<!doctype html>
<html>
<head>
  <title>ORG ROAM GRAPH</title>
  <script src="jquery-3.5.0.min.js"></script>
  <script type="text/javascript" src="vis-network.min.js"></script>
  <style type="text/css">
    * { padding: 0; margin: 0; }
    html, body, #network {
        min-height: 100% !important;
        height: 100%;
        width: 100%;
    }
  </style>
</head>
<body>
<div id="network"></div>
<script type="text/javascript">
  $(document).ready(function () {
      var container = document.getElementById('network');
      const source = new EventSource("/graph-data");
      old_data = "";
      var options = {};
      source.onmessage = function (event) {
          if (old_data.localeCompare(event.data) != 0) {
              old_data = event.data;
              graph = JSON.parse(event.data);
              var network = new vis.Network(container, graph, options);
              network.on("selectNode", function (params) {
                  if (params.nodes.length === 1) {
                      var node = params.nodes[0];
                      window.open(network.body.nodes[node].options.url, '_self');
                  }
              });
          }
      }
  });
</script>
</body>
</html>
